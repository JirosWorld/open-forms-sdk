/**
 * TODO: properly refactor these components, the styles are bonkers...
 */
@use 'sass:math';
@use 'microscope-sass/lib/bem';

@import '~microscope-sass/lib/grid';
@import '~microscope-sass/lib/typography';

@import '@utrecht/components/dist/button/css/index.css';
@import '@utrecht/components/dist/button-link/css/index.css';

@import '../mixins/prefix';

$button-line-height: $typography-line-height-text-big * $typography-font-size-text-big;
$button-line-height-px: math.div($button-line-height, ($button-line-height * 0 + 1)) * 16px;
$button-padding-v: math.div(($grid-row-height - $button-line-height-px), 2) -
  $typography-size-border;
$button-padding-h: $grid-margin-2;

@mixin button-theme(
  $name,
  $color,
  $color-background,
  $color-border: var(--of-color-bg),
  $color-background-hover: null,
  $color-border-hover: null,
  $color-active: null,
  $color-background-active: null,
  $color-border-active: null,
  $force-colors: false,
  $color-border-focus: null
) {
  // build the selector either as just the parent or the parent with modifier,
  // based on the theme name
  $sel: #{&};

  @if $name != '' {
    $sel: '#{&}--#{$name}';
  }

  // now output the actual CSS rules
  @at-root #{$sel} {
    @if $force-colors {
      color: $color !important;
      background-color: $color-background !important;
    } @else {
      color: $color;
      background-color: $color-background;
    }

    // TODO: can be removed once there are utrecht design tokens for the bottom/right
    // border color
    border-right-color: $color-border !important;
    border-bottom-color: $color-border !important;

    &:focus,
    &:focus-visible {
      // TODO: can be removed once there are utrecht design tokens for the bottom/right border color
      // issue: https: //github.com/nl-design-system/utrecht/issues/1406
      border-color: $color-border-focus !important;
      border-right-color: $color-border-focus !important;
      border-bottom-color: $color-border-focus !important;
      // TODO: can be removed once there are utrecht design tokens for the border-width
      border-width: 2px !important;
    }

    &:not([aria-disabled='true']):hover {
      @if $color-background-hover {
        background-color: $color-background-hover;
      }

      @if $color-border-hover {
        // TODO: can be removed once there are utrecht design tokens for the bottom/right
        // border color
        border-right-color: $color-border-hover !important;
        border-bottom-color: $color-border-hover !important;
      }
    }

    &:active {
      // TODO: can be removed once there are utrecht design tokens for the bottom/right
      // border color
      @if $color-active {
        color: $color-active !important;
      }

      @if $color-background-active {
        background-color: $color-background-active !important;
      }

      @if $color-border-active {
        // TODO: can be removed once there are utrecht design tokens for the bottom/right
        // border color
        border-top-color: $color-border-active !important;
        border-right-color: transparent !important;
        border-left-color: $color-border-active !important;
        border-bottom-color: transparent !important;
      }
    }
  }
}

.#{prefix(button)} {
  @include body;
  @include body--big;
  @include border(all, $color: transparent, $size: 2px);
  @include button-theme(
    '',
    $typography-color-text,
    $color-background,
    $color-border,
    $color-background-hover: var(--of-button-hover-bg),
    $color-border-hover: var(--of-button-hover-color-border),
    $color-active: var(--of-button-active-fg),
    $color-background-active:
      var(--of-button-active-bg, var(--utrecht-button-active-background-color)),
    $color-border-active:
      var(--of-button-active-color-border, var(--utrecht-button-active-border-color)),
    $color-border-focus:
      var(--of-button-focus-color-border, var(--utrecht-button-focus-border-color))
  );
  @include button-theme(
    'primary',
    var(--of-button-primary-fg),
    var(--of-button-primary-bg),
    var(--of-button-primary-color-border),
    $color-background-hover: var(--of-button-primary-hover-bg),
    $color-border-hover: var(--of-button-primary-hover-color-border),
    $color-active: var(--of-button-primary-active-fg),
    $color-background-active: var(--of-button-primary-active-bg),
    $color-border-active: var(--of-button-primary-active-color-border),
    $color-border-focus:
      var(
        --of-button-primary-focus-color-border,
        var(--utrecht-button-primary-action-focus-border-color)
      )
  );
  @include button-theme(
    'danger',
    var(--of-button-danger-fg),
    var(--of-button-danger-bg),
    var(--of-button-danger-color-border),
    $color-background-hover: var(--of-button-danger-hover-bg),
    $color-border-hover: var(--of-button-danger-hover-color-border),
    $color-active: var(--of-button-danger-active-fg),
    $color-background-active: var(--of-button-danger-active-bg),
    $color-border-active: var(--of-button-danger-active-color-border),
    $color-border-focus:
      var(
        --of-button-danger-focus-color-border,
        var(--utrecht-button-primary-action-danger-focus-border-color)
      )
  );

  appearance: none;
  border-radius: 0;
  display: flex;
  align-items: center;
  padding: $button-padding-v $button-padding-h;
  text-decoration: none;
  float: left;

  @media print {
    display: none;
  }

  &:not([aria-disabled='true']) {
    cursor: pointer;
  }

  // styling for disabled button
  &[aria-disabled='true'] {
    cursor: not-allowed;
    filter: saturate(0);
    opacity: 0.5;
  }

  .fa-icon:not(:last-child) {
    margin-right: $button-padding-h;
  }

  @include bem.modifier('icon-only') {
    color: var(--of-button-fg);
    background-color: transparent;
    border-style: none;
    --utrecht-button-hover-background-color: transparent;

    &:hover,
    &:active {
      --utrecht-button-hover-color: var(--of-button-fg);
      color: var(--of-button-fg);
      background-color: transparent;
      border-style: none;
    }

    &.#{prefix(button)}--danger {
      color: var(--of-button-danger-bg);
    }
  }

  // anchor variants, these map to utrecht components:
  // * UtrechtButton (the default)
  // * UtrechtButtonLink (`a` component)
  // * UtrechtLinkButton (`button` component)
  @include bem.modifier('anchor') {
    @include button-theme(
      '',
      var(--of-button-anchor-fg, var(--utrecht-link-color)),
      var(--of-button-anchor-bg),
      var(--of-button-anchor-color-border),
      $color-background-hover: var(--of-button-anchor-hover-bg, var(--utrecht-link-hover-color)),
      $color-border-hover: var(--of-button-anchor-hover-color-border),
      $color-active: var(--of-button-anchor-active-fg),
      $color-background-active: var(--of-button-anchor-active-bg),
      $color-border-active: var(--of-button-anchor-active-color-border),
      $color-border-focus:
        var(--of-button-anchor-focus-color-border, var(--utrecht-button-focus-border-color)),
      $force-colors: true // there will not be an anchor variant
    );

    // the OPPOSITE of what we normally do
    text-decoration: var(--utrecht-link-hover-text-decoration, none);
    &:hover {
      --of-button-anchor-fg: var(--utrecht-link-hover-color);
      text-decoration: var(--utrecht-link-text-decoration, underline);
    }
  }
}

// TODO: can be removed once there are utrecht design tokens for the bottom/right border color
// issue: https: //github.com/nl-design-system/utrecht/issues/1406
.utrecht-button {
  @include bem.modifier('primary-action') {
    &:not(.utrecht-button--danger) {
      // --utrecht-button-primary-action-focus-border-color is used to make the borders invisible,
      // and the rules below to make the right/bottom borders visible
      border-right-color: var(--of-button-primary-color-border);
      border-bottom-color: var(--of-button-primary-color-border);

      &:hover,
      &:focus-visible {
        border-right-color: var(--of-button-primary-focus-color-border) !important;
        border-bottom-color: var(--of-button-primary-focus-color-border) !important;
      }
    }
  }

  @include bem.modifier('danger') {
    &:not(.utrecht-button--subtle) {
      // --utrecht-button-primary-action-danger-border-color is used to make the borders invisible,
      // and the rules below to make the right/bottom borders visible
      border-right-color: var(--of-button-danger-color-border);
      border-bottom-color: var(--of-button-danger-color-border);

      &:hover,
      &:focus-visible {
        border-right-color: var(--of-button-danger-focus-color-border) !important;
        border-bottom-color: var(--of-button-danger-focus-color-border) !important;
      }
    }
  }

  @include bem.modifier('secondary-action') {
    border-right-color: var(--of-button-active-color-border);
    border-bottom-color: var(--of-button-active-color-border);

    &:hover,
    &:focus-visible {
      border-right-color: var(--of-button-hover-color-border) !important;
      border-bottom-color: var(--of-button-hover-color-border) !important;
    }
  }
}

.utrecht-button-link {
  @include bem.modifier('html-a') {
    border-right-color: var(--of-button-active-color-border);
    border-bottom-color: var(--of-button-active-color-border);

    &:hover,
    &:focus-visible {
      border-right-color: var(--of-button-hover-color-border) !important;
      border-bottom-color: var(--of-button-hover-color-border) !important;
    }
  }
}
