import {Canvas, Meta, Story} from '@storybook/addon-docs';
import {expect} from '@storybook/jest';
import {userEvent, within} from '@storybook/testing-library';

import Card from 'components/Card';
import {ConfigDecorator, FormikDecorator} from 'story-utils/decorators';

import LocationAndTimeStep from './LocationAndTimeStep';
import {
  mockAppointmentDatesGet,
  mockAppointmentLocationsGet,
  mockAppointmentTimesGet,
} from './mocks';

export const Template = args => (
  <Card title={args.formName} titleComponent="h1" modifiers={['mobile-header-hidden']}>
    <LocationAndTimeStep />
  </Card>
);

<Meta
  title="Private API / Appointments / Steps / Location and time"
  component={LocationAndTimeStep}
  decorators={[FormikDecorator, ConfigDecorator]}
  parameters={{
    controls: {hideNoControlsWarning: true},
    formik: {
      initialValues: {
        products: [{product: '166a5c79', amount: 1}],
        location: '',
        date: '',
        time: '',
      },
    },
    msw: {
      handlers: [mockAppointmentLocationsGet, mockAppointmentDatesGet, mockAppointmentTimesGet],
    },
  }}
  args={{
    formName: 'Appointment form',
  }}
/>

## Location and time step

The appointment form requires users to select the location for their appointment and the moment
they'd like to visit.

This component enables the UX to select an available location. The input of product(s) and location
then determines the available dates. Finally, the selected date determins the available times. A
location, date and time must be provided as input by the user.

**TODO**: in the current iteration, the location follows product selection, but this order should be
swapped.

<Canvas>
  <Story
    name="Initial state"
    play={async ({canvasElement}) => {
      const canvas = within(canvasElement);
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>
