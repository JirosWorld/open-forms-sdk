import {Canvas, Meta, Story} from '@storybook/addon-docs';
import {expect} from '@storybook/jest';
import {userEvent, within} from '@storybook/testing-library';
import {withRouter} from 'storybook-addon-react-router-v6';

import Card from 'components/Card';
import {ConfigDecorator, FormikDecorator, LayoutDecorator} from 'story-utils/decorators';

import LocationAndTimeStep from './LocationAndTimeStep';
import {
  mockAppointmentDatesGet,
  mockAppointmentLocationsGet,
  mockAppointmentProductsGet,
  mockAppointmentTimesGet,
} from './mocks';

<Meta
  title="Private API / Appointments / Steps / Location and time"
  component={LocationAndTimeStep}
  decorators={[LayoutDecorator, FormikDecorator, withRouter, ConfigDecorator]}
  parameters={{
    controls: {hideNoControlsWarning: true},
    formik: {
      initialValues: {
        products: [{product: '166a5c79', amount: 1}],
        location: '',
        date: '',
        time: '',
      },
    },
    msw: {
      handlers: [
        mockAppointmentProductsGet,
        mockAppointmentLocationsGet,
        mockAppointmentDatesGet,
        mockAppointmentTimesGet,
      ],
    },
  }}
/>

## Location and time step

The appointment form requires users to select the location for their appointment and the moment
they'd like to visit.

This component enables the UX to select an available location. The input of product(s) and location
then determines the available dates. Finally, the selected date determines the available times. A
location, date and time must be provided as input by the user.

**TODO**: in the current iteration, the location follows product selection, but this order should be
swapped.

<Canvas>
  <Story
    name="Initial state"
    play={async ({canvasElement}) => {
      const canvas = within(canvasElement);
    }}
  >
    <Card>
      <LocationAndTimeStep />
    </Card>
  </Story>
</Canvas>
