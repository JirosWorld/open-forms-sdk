import {Canvas, Meta, Story} from '@storybook/addon-docs';
import {expect} from '@storybook/jest';
import {userEvent, within} from '@storybook/testing-library';

import {FormikDecorator} from 'story-utils/decorators';

import EmailField from './EmailField';

export const Template = args => <EmailField {...args} />;

<Meta
  title="Pure React Components / Forms / EmailField"
  decorators={[FormikDecorator]}
  component={EmailField}
  parameters={{
    formik: {
      initialValues: {
        email: 'test',
      },
    },
  }}
/>

<Canvas>
  <Story
    name="Default"
    args={{
      name: 'email',
      id: 'email',
      label: 'Email',
      description: 'This is a custom description for the email field',
      disabled: false,
      isRequired: true,
    }}
    play={async ({canvasElement}) => {
      const canvas = within(canvasElement);
      const input = canvas.getByLabelText('Email');
      await expect(input).toBeVisible();
      await expect(canvas.getByRole('textbox')).toBe(input);
      await expect(input.type).toBe('email');
      await expect(
        canvas.getByText('This is a custom description for the email field')
      ).toBeVisible();
      // Check if clicking on the label focuses the input
      const label = canvas.getByText('Email');
      userEvent.click(label);
      await expect(canvas.getByRole('textbox')).toHaveFocus();
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>
