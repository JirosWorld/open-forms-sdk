import {Canvas, Meta, Story, ArgsTable} from '@storybook/addon-docs';
import {FormioComponent, FormDecorator} from './story-util';
import {within, userEvent, waitFor} from '@storybook/testing-library';

import Component from './Component';

<Meta
  title="Form.io components/Component"
  argTypes={{}}
  decorators={[FormDecorator]}
  parameters={{
    controls: {sort: 'requiredFirst'},
  }}
/>

# Component

The wrapping component provides error containers for inputs, with accessibility taken into account.

## Aria-live assertive

When a user types faulty values into a field, essential errors should be read fro mthe screenreader with an assertive voice.

export const AssertiveTemplate = ({...args}) => (
  <FormioComponent
    component={{
      label: 'TextField',
      type: 'textfield',
      validateOn: 'blur',
    }}
  />
);

<Canvas>
  <Story
    name="Aria-live assertive"
    args={{}}
    play={async ({args, canvasElement}) => {
      const canvas = within(canvasElement);
      const testfield = canvas.getByLabelText('TextField');
      await userEvent.click(testfield);
      await userEvent.keyboard('test');
      // validation test for blur/change events
      // aria-live attribute must show up as assertive
      // while typing nothing should happen, only on blur
    }}
  >
    {AssertiveTemplate.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Aria-live assertive" />



## Aria-live polite

When a user types values into a 'live' field, errors should be read from the screenreader with a polite voice, in order not to intrude too much while typing.

export const PoliteTemplate = ({...args}) => (
  <FormioComponent
    component={{
      label: 'PhoneNumber',
      type: 'phoneNumber',
      validateOn: 'change',
    }}
  />
);

<Canvas>
  <Story
    name="Aria-live polite"
    args={{}}
    play={async ({args, canvasElement}) => {
      const canvas = within(canvasElement);
      const testfield = canvas.getByLabelText('PhoneNumber');
      await userEvent.click(testfield);
      await userEvent.keyboard('0101234567');
      // validation test for blur/change events
      // aria-live attribute must show up as polite
      // while typing this must become visible
    }}
  >
    {PoliteTemplate.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Aria-live polite" />
